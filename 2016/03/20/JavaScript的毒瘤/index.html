<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>JavaScript语言的毒瘤 | TanhanJay's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JavaScript语言的毒瘤</h1><a id="logo" href="/.">TanhanJay's Blog</a><p class="description">code and life</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JavaScript语言的毒瘤</h1><div class="post-meta">Mar 20, 2016<span> | </span><span class="category"><a href="/categories/JavaScript/">JavaScript</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/03/20/JavaScript的毒瘤/" href="/2016/03/20/JavaScript的毒瘤/#comments" class="ds-thread-count"></a><div class="post-content"><h1 id="JavaScript语言的毒瘤"><a href="#JavaScript语言的毒瘤" class="headerlink" title="JavaScript语言的毒瘤"></a>JavaScript语言的毒瘤</h1><h3 id="自动插入分号"><a href="#自动插入分号" class="headerlink" title="自动插入分号"></a>自动插入分号</h3><p>JavaScript有一个自动修复机制，它试图通过自动插入分号来修正有缺损的程序。但是，千万不要指望它，它可能会掩盖更为严重的错误。<br>有时它会不合时宜地插入分号。请考虑在return语句中自动插入分号导致的后果。如果一个return语句返回一个值，这个值表达式的开始部分必须和return位于同一行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span></span><br><span class="line">    &#123;</span><br><span class="line">      status:<span class="literal">true</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>这看起来是要返回一个包含status成员元素的对象。遗憾的是，自动插入分号让它变成了返回undefined。自动插入分号导致程序被误解，却没有任何警告提醒。如果把{放在上一行的尾部而不是下一行的头部就可以避免该问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  status: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="保留字"><a href="#保留字" class="headerlink" title="保留字"></a>保留字</h3><p>下面的单词在JavaScript里被保留：<br>abstract boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof var volatile void while with</p>
<p>这些单词中的大多数并没有在语言中使用。<br>它们不能被用来命名变量或参数。当保留字被用作对象字面量的键值时，它们必须被引号括起来。它们不能被用在点表示法中，所以有时必须使用括号表示法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> method;                   <span class="comment">//ok</span></span><br><span class="line"><span class="keyword">var</span> <span class="class"><span class="keyword">class</span></span>;                    <span class="comment">//非法</span></span><br><span class="line">object = &#123;box: value&#125;;        <span class="comment">//ok</span></span><br><span class="line">object = &#123;<span class="keyword">case</span>: value&#125;;       <span class="comment">//非法</span></span><br><span class="line">object = &#123;<span class="string">'case'</span>: value&#125;;     <span class="comment">//ok</span></span><br><span class="line">object.box = value;           <span class="comment">//ok</span></span><br><span class="line">object.case = value;          <span class="comment">//非法</span></span><br><span class="line">object[<span class="string">'case'</span>] = value;       <span class="comment">//ok</span></span><br></pre></td></tr></table></figure>
<h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><p>typeof 运算符返回一个用于识别其运算数类型的字符串。所以：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof 98.6</span><br></pre></td></tr></table></figure>
<p>返回‘number’。遗憾的是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof null</span><br></pre></td></tr></table></figure>
<p>返回’object’而不是’null’。这简直太糟糕了。其实，有更简单也更好的检测null的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_value === null</span><br></pre></td></tr></table></figure>
<p>一个更大的问题是检测对象的值。typeof不能辨识出null于对象，但你可以下面这样做，因为null值为假，而所有对象值为真：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (my_value &amp;&amp; <span class="keyword">typeof</span> === <span class="string">'object'</span>) &#123;</span><br><span class="line">  <span class="comment">// my_value 是一个对象或数组！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相关的内容，请参阅后面的小节”NaN”和“伪数组”。</p>
<p>在对正则表达式的类型识别上，各种JavaScript的实现不太一致。对于下面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> /a/</span><br></pre></td></tr></table></figure>
<p>一些实现会返回’object’,而其他的返回’function’。如果返回’regexp’可能会更有用些，但标准不允许这么做。</p>
<h3 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h3><p>NaN 是IEEE754中定义的一个特殊的数量值。它表示的不是一个数字，尽管下面的表达式返回的是true:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="literal">NaN</span> === <span class="string">'number'</span> <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>该值可能会在试图把非数字形式的字符串转换为数字时产生。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="string">'0'</span> <span class="comment">//0</span></span><br><span class="line">+ <span class="string">'oops'</span> <span class="comment">//NaN</span></span><br></pre></td></tr></table></figure>
<p>如果NaN是数学运算中的一个运算数，那么结果就是NaN。所以，如果你有一个公式链产生出NaN的结果，那肯定要么其中一个输入项是NaN，要么在某个地方产生了NaN。</p>
<p>你可以对NaN进行检测。正如我们之前所见，typeof不能辨别数字和NaN，而且NaN也不等同于它自己。所以，下面的代码结果令人惊讶：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NaN</span> === <span class="literal">NaN</span> <span class="comment">//false</span></span><br><span class="line"><span class="literal">NaN</span> !== <span class="literal">NaN</span> <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>JavaScript 提供了一个isNaN函数，可以辨别数字与NaN:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isNaN</span>(<span class="literal">NaN</span>)		<span class="comment">//true</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="number">0</span>)		<span class="comment">//false</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="string">'oops'</span>)	<span class="comment">//true</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="string">'0'</span>)		<span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<p>判断一个值是否可用做数字的最佳方法是使用isFinite函数，因为它会筛除掉NaN和Infinity。遗憾的是isFinite会试图把它的运算数转换成一个数字，所以，如果值事实上不是一个数字，它就不是一个好的测试。你可以这样定义自己的isNumber函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isNumber = <span class="function"><span class="keyword">function</span> <span class="title">isNumber</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">'number'</span> &amp;&amp; <span class="built_in">isFinite</span>(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="伪数组"><a href="#伪数组" class="headerlink" title="伪数组"></a>伪数组</h3><p>JavaScript没有真正的数组。这也不全是坏事。JavaScript的数组确实非常容易使用。你不必给它们设置维度，而且它们永远不会产生越界（out-of-bounds）错误。但它们的性能相比真正的数组可能相当糟糕。</p>
<p>typeof运算符不能辨别数组和对象。要辨别一个值是否为数组，你还需要检查它的constructor属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(my_value &amp;&amp; <span class="keyword">typeof</span> my_value === <span class="string">'object'</span> &amp;&amp; my_value.constructor === <span class="built_in">Array</span>) &#123;</span><br><span class="line">  	<span class="comment">//my_value是一个数组。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的检测对于在不同帧或窗口创建的数组将会给出false。当数组有可能在其他的帧中被创建时，下面的检测更为可靠：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.apply(my_value) === <span class="string">'[object Array]'</span>)&#123;</span><br><span class="line">  <span class="comment">//my_value 确实是一个数组！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>arguments数组不是一个数组，它只是一个有着length成员属性的对象。上面的检测会分辨出arguments并不是一个数组。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="tanhanjay.top/2016/03/20/JavaScript的毒瘤/" data-id="cin2p6fgo0001zdz3gbdam02b" class="article-share-link">Share</a><div class="tags"></div><div class="post-nav"><a href="/2016/03/25/JavaScript Bad Parts/" class="pre">JavaScript Bad Parts</a></div><div data-thread-key="2016/03/20/JavaScript的毒瘤/" data-title="JavaScript语言的毒瘤" data-url="tanhanjay.top/2016/03/20/JavaScript的毒瘤/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/03/20/JavaScript的毒瘤/" data-title="JavaScript语言的毒瘤" data-url="tanhanjay.top/2016/03/20/JavaScript的毒瘤/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="tanhanjay.top"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/unix-linux/">unix/linux</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/英语学习-考研党/" style="font-size: 15px;">英语学习 考研党</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/Jade/" style="font-size: 15px;">Jade</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a> <a href="/tags/前端学习看过的书/" style="font-size: 15px;">前端学习看过的书</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/04/16/练恋有词笔记/">练恋有词笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/03/Javascript-Jquery-交互式Web前端开发读书笔记/">Javascript & Jquery 交互式Web前端开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/03/最近在看的书/">最近在看的书</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/LearnCode笔记-ES6新特性/">LearnCode笔记--ES6新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/28/Jade教程/">Jade教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/28/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/27/MDN-CSS入门教程学习笔记/">MDN-CSS入门教程学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/常用的终端(Terminal)命令/">常用的终端（Terminal）命令（适用于Mac OSX）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/25/JavaScript Bad Parts/">JavaScript Bad Parts</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/20/JavaScript的毒瘤/">JavaScript语言的毒瘤</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> Recent Comments</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="https://github.com/tanhanjay" title="我的GitHub" target="_blank">我的GitHub</a><ul></ul><a href="http://weibo.com/1952294785/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" title="微博" target="_blank">微博</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">TanhanJay's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'tanhanjay'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?true";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>